<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Papelaria Personalizada</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="app">
        <h1>Crie seu Produto Personalizado</h1>
        <div id="model-container"></div>
        <div id="controls">
            <label for="base-shape">Escolha a Base:</label>
            <select id="base-shape">
                <option value="round">Redondo</option>
                <option value="square">Quadrado</option>
                <option value="heart">Coração</option>
            </select>

            <label for="base-color">Cor da Base:</label>
            <input type="color" id="base-color" value="#ff0000">

            <label for="image-upload">Adicionar Imagem:</label>
            <input type="file" id="image-upload" accept="image/*">

            <label for="custom-text">Texto Personalizado:</label>
            <input type="text" id="custom-text" placeholder="Digite sua mensagem">
            <button id="add-text">Adicionar Texto</button>

            <button id="submit-order">Enviar Pedido</button>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
body {
    font-family: Arial, sans-serif;
    background-color: #f9f9f9;
    text-align: center;
}

#app {
    margin: 20px;
}

#model-container {
    width: 300px;
    height: 300px;
    border: 1px solid #ccc;
    margin: 20px auto;
    position: relative;
}

#controls {
    margin-top: 20px;
}
let scene, camera, renderer, baseShape, baseColor;
let elements = []; // Array para armazenar elementos adicionados

function init() {
    // Configuração da cena
    scene = new THREE.Scene();
    camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    renderer = new THREE.WebGLRenderer();
    renderer.setSize(300, 300);
    document.getElementById('model-container').appendChild(renderer.domElement);

    // Adiciona uma luz
    const light = new THREE.AmbientLight(0xffffff);
    scene.add(light);

    // Cria a base do topo de bolo
    createBase('round', '#ff0000');

    camera.position.z = 5;
    animate();
}

function createBase(shape, color) {
    if (baseShape) {
        scene.remove(baseShape);
    }

    let geometry;
    if (shape === 'round') {
        geometry = new THREE.CylinderGeometry(1, 1, 0.2, 32);
    } else if (shape === 'square') {
        geometry = new THREE.BoxGeometry(1, 0.2, 1);
    } else if (shape === 'heart') {
        const heartShape = new THREE.Shape();
        heartShape.moveTo(0, 0);
        heartShape.bezierCurveTo(0, 1, 1, 1, 1, 0);
        heartShape.bezierCurveTo(1, -1, 0, -1, 0, 0);
        geometry = new THREE.ShapeGeometry(heartShape);
    }

    const material = new THREE.MeshBasicMaterial({ color: color });
    baseShape = new THREE.Mesh(geometry, material);
    scene.add(baseShape);
}

document.getElementById('base-shape').addEventListener('change', function() {
    createBase(this.value, baseColor);
});

document.getElementById('base-color').addEventListener('input', function() {
    baseColor = this.value;
    createBase(document.getElementById('base-shape').value, baseColor);
});

document.getElementById('image-upload').addEventListener('change', function(event) {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        const texture = new THREE.TextureLoader().load(e.target.result);
        const geometry = new THREE.PlaneGeometry(0.5, 0.5); // Tamanho da imagem
        const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
        const imageMesh = new THREE.Mesh(geometry, material);
        imageMesh.position.set(0, 0.5, 0); // Posição acima da base
        elements.push(imageMesh);
        scene.add(imageMesh);
    };
    reader.readAsDataURL(file);
});

document.getElementById('add-text').addEventListener('click', function() {
    const text = document.getElementById('custom-text').value;
    const textGeometry = new THREE.TextGeometry(text, {
        font: new THREE.FontLoader().parse(/* Carregue uma fonte aqui */),
        size: 0.1,
        height: 0.01,
    });
    const textMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
    const textMesh = new THREE.Mesh(textGeometry, textMaterial);
    textMesh.position.set(0, 0.7, 0); // Posição acima da base
    elements.push(textMesh);
    scene.add(textMesh);
});

document.getElementById('submit-order').addEventListener('click', function() {
    capturePreview();
});

function capturePreview() {
    renderer.render(scene, camera);
    const dataURL = renderer.toDataURL("image/png");
    const previewWindow = window.open("", "_blank");
    previewWindow.document.write('<img src="' + dataURL + '" style="width:300px;height:300px;"/>');
}

function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
}

init();
